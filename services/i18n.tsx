
import React, { createContext, useContext, useState, ReactNode } from 'react';

export type Language = 'en' | 'zh-CN' | 'zh-TW';

export const translations = {
  'en': {
    'app.title': 'SmartMortgage',
    'app.subtitle': 'Strategic decision support for homeowners in China. Navigate LPR changes, early repayment, and policy eligibility.',
    'nav.dashboard': 'Strategy Dashboard',
    'nav.loans': 'Loan Manager',
    'nav.policy': 'Policy Decoder',
    'nav.opportunity': 'Opp. Cost',
    'ticker.update': 'UPDATE: 5-Year LPR is now 3.60% • Provident Fund 2.85%',
    'ticker.live': 'LIVE',
    
    'loan.manager.title': 'Loan Portfolio Manager',
    'loan.manager.subtitle': 'Manage your existing debt structure',
    'loan.total_outstanding': 'Total Outstanding',
    'loan.weighted_rate': 'Weighted Rate',
    'loan.filter.label': 'Filter by Type',
    'loan.tab.combined': 'Combined',
    'loan.tab.commercial': 'Commercial',
    'loan.tab.provident': 'Provident',
    'loan.type.commercial': 'Commercial Loan',
    'loan.type.provident': 'Provident Fund',
    'loan.label.balance': 'Balance (RMB)',
    'loan.label.rate': 'Rate (%)',
    'loan.label.months': 'Months Left',
    'loan.label.method': 'Method',
    'loan.method.equal_payment': 'Equal Payment',
    'loan.method.equal_principal': 'Equal Principal',
    'loan.add.commercial': 'Add Commercial',
    'loan.add.provident': 'Add Provident',
    'loan.empty': 'No loans found in this category.',
    'loan.history.title': 'Benchmark Rate Trends',
    'loan.history.subtitle': 'Standard 5-Year+ loan rates over recent years',
    'loan.schedule.view': 'View Schedule',
    'loan.schedule.hide': 'Hide Schedule',
    'loan.schedule.title': 'Amortization Schedule',
    'loan.schedule.desc': 'Green represents Principal (pays down debt), Red represents Interest (bank profit). Early payments often consist mostly of interest.',
    'loan.schedule.principal': 'Principal',
    'loan.schedule.interest': 'Interest',
    'loan.schedule.balance': 'Remaining Balance',
    'loan.schedule.month': 'Month',
    'loan.clear.button': 'Clear All',
    'loan.clear.confirm': 'Are you sure you want to delete all loans? This action cannot be undone.',
    'loan.error.balance': 'Balance must be positive',
    'loan.error.rate': 'Rate cannot be negative',
    'loan.error.months': 'Months must be a positive integer',
    'loan.error.required': 'Required',
    'loan.recurring.title': 'Recurring Payment Settings',
    'loan.recurring.btn': 'Recurring',
    'loan.recurring.enable': 'Enable Recurring Payment',
    'loan.recurring.amount': 'Payment Amount',
    'loan.recurring.frequency': 'Frequency',
    'loan.freq.weekly': 'Weekly',
    'loan.freq.bi_weekly': 'Bi-Weekly',
    'loan.freq.monthly': 'Monthly',

    'strat.title': 'Repayment Strategy Engine',
    'strat.cash_on_hand': 'Cash on Hand (RMB)',
    'strat.safety_buffer': 'Safety Buffer',
    'strat.safety_desc': 'Reserve this amount for emergencies. Actual repayment:',
    'strat.chart.title': 'Total Interest Comparison',
    'strat.chart.current': 'Current',
    'strat.chart.option_a': 'Option A (Shorten)',
    'strat.chart.option_b': 'Option B (Reduce)',
    'strat.opt_a.title': 'Option A: Shorten Term',
    'strat.opt_a.tag': 'Wealth Maximizer',
    'strat.opt_a.saved': 'Total Interest Saved',
    'strat.opt_a.new_monthly': 'New Monthly Pay',
    'strat.opt_a.term_reduced': 'Term Reduced',
    'strat.opt_a.significantly': 'Significantly',
    'strat.opt_b.title': 'Option B: Reduce Payment',
    'strat.opt_b.tag': 'Cash Flow King',
    'strat.opt_b.reduction': 'Monthly Reduction',
    'strat.sim_loan.add_btn': 'Add Hypothetical Loan',
    'strat.sim_loan.title': 'Additional Loans (Simulation Only)',
    'strat.sim_loan.add_title': 'Add Loan to Simulation',
    'strat.sim_loan.cancel': 'Cancel',
    'strat.sim_loan.add': 'Add Loan',

    'opp.title': 'Opportunity Cost Analyzer',
    'opp.cost_debt': 'Cost of Debt (Weighted)',
    'opp.invest_return': 'Your Investment Return (%)',
    'opp.invest_desc': "E.g., Yu'e Bao, Bank Wealth Management",
    'opp.repay.title': 'REPAY LOAN',
    'opp.repay.desc': 'Your debt cost exceeds your investment return. Holding cash is losing money.',
    'opp.repay.loss': 'Projected 10-Year Loss on 500k:',
    'opp.hold.title': 'HOLD CASH',
    'opp.hold.desc': 'Your investments outperform your loan interest. Keep the liquidity.',
    'opp.hold.gain': 'Arbitrage Gain:',
    'opp.why.title': 'Why Opportunity Cost Matters',
    'opp.why.desc': "In the current Chinese economic environment, the spread between loan interest rates (Cost of Debt) and safe investment yields (Return on Cash) dictates your best move. If your mortgage rate (e.g., 3.85%) is higher than what you can earn from a bank deposit or bond fund (e.g., 2.5%), you are effectively losing money every day you don't repay.",

    'policy.title': 'Policy & Eligibility Decoder',
    'policy.city.label': 'Select Your City',
    'policy.prop.label': 'How many residential properties does your family currently own in {city}?',
    'policy.hist.title': 'Mortgage History',
    'policy.hist.desc': 'Have you ever had a housing loan record (paid off or ongoing) anywhere in China?',
    'policy.hist.yes': 'Yes, I have history',
    'policy.hist.no': 'No, never',
    'policy.back': 'Back',
    'policy.status.first': 'First Home Buyer',
    'policy.status.second': 'Second Home Buyer',
    'policy.result.desc': 'Based on "Recognize Home, Not Loan" policy in {city}.',
    'policy.down_payment': 'Down Payment',
    'policy.rate_floor': 'Interest Rate Floor',
    'policy.analysis': 'Analysis:',
    'policy.analysis.text': 'Because you own {count} properties in {city}, your previous loan history is {historyStatus}.',
    'policy.analysis.ignored': 'ignored',
    'policy.analysis.secondary': 'considered secondary',
    'policy.analysis.bonus': 'Even though you had a loan before, you are treated as a First Home Buyer now!',
    'policy.check_another': 'Check Another Scenario',

    'lpr.title': 'Historical LPR Trends',
    'lpr.subtitle': '5-Year (Mortgage) vs 1-Year Rate History',
    'lpr.legend.5y': '5-Year LPR',
    'lpr.legend.1y': '1-Year LPR',
    'lpr.source': 'Data Source: PBOC / National Interbank Funding Center',
    'lpr.updated': 'Last Updated: Jan 2025',
    'lpr.loading': 'Loading market data...',
    'lpr.error': 'Unable to fetch latest LPR rates.',
    'lpr.retry': 'Retry',

    'ai.title': 'AI Financial Consultant',
    'ai.desc': 'Not sure what to do? Let our Gemini AI analyze your specific debt structure, opportunity costs, and repayment scenarios to provide a personalized recommendation.',
    'ai.btn.generate': 'Generate Analysis Report',
    'ai.loading': 'Consulting the financial models...',
    'ai.clear': 'Clear Analysis'
  },
  'zh-CN': {
    'app.title': '智策房贷 CN',
    'app.subtitle': '中国业主的战略决策支持系统。应对LPR调整、提前还款和政策资格认定。',
    'nav.dashboard': '策略仪表盘',
    'nav.loans': '贷款管理',
    'nav.policy': '政策解读',
    'nav.opportunity': '机会成本',
    'ticker.update': '更新：5年期LPR现为 3.60% • 公积金 2.85%',
    'ticker.live': '实时',

    'loan.manager.title': '贷款组合管理器',
    'loan.manager.subtitle': '管理您现有的债务结构',
    'loan.total_outstanding': '剩余贷款总额',
    'loan.weighted_rate': '加权利率',
    'loan.filter.label': '按类型筛选',
    'loan.tab.combined': '综合',
    'loan.tab.commercial': '商业贷款',
    'loan.tab.provident': '公积金',
    'loan.type.commercial': '商业贷款',
    'loan.type.provident': '公积金',
    'loan.label.balance': '余额 (元)',
    'loan.label.rate': '利率 (%)',
    'loan.label.months': '剩余月数',
    'loan.label.method': '还款方式',
    'loan.method.equal_payment': '等额本息',
    'loan.method.equal_principal': '等额本金',
    'loan.add.commercial': '添加商贷',
    'loan.add.provident': '添加公积金',
    'loan.empty': '该类别下没有贷款。',
    'loan.history.title': '基准利率走势',
    'loan.history.subtitle': '近几年5年以上贷款基准利率变化',
    'loan.schedule.view': '查看还款计划',
    'loan.schedule.hide': '收起还款计划',
    'loan.schedule.title': '还款计划表（未来5年）',
    'loan.schedule.desc': '绿色代表本金（减少债务），红色代表利息（银行收益）。通常还款初期利息占比较大。',
    'loan.schedule.principal': '本金',
    'loan.schedule.interest': '利息',
    'loan.schedule.balance': '剩余本金',
    'loan.schedule.month': '期数',
    'loan.clear.button': '清空全部',
    'loan.clear.confirm': '确定要删除所有贷款吗？此操作无法撤销。',
    'loan.error.balance': '贷款余额必须大于0',
    'loan.error.rate': '利率不能为负数',
    'loan.error.months': '剩余月数必须为正整数',
    'loan.error.required': '必填项',
    'loan.recurring.title': '周期性还款设置',
    'loan.recurring.btn': '周期还款',
    'loan.recurring.enable': '开启周期性还款',
    'loan.recurring.amount': '还款金额',
    'loan.recurring.frequency': '频率',
    'loan.freq.weekly': '每周',
    'loan.freq.bi_weekly': '每两周',
    'loan.freq.monthly': '每月',

    'strat.title': '还款策略引擎',
    'strat.cash_on_hand': '手头现金 (元)',
    'strat.safety_buffer': '安全缓冲资金',
    'strat.safety_desc': '保留此金额用于应急。实际还款金额：',
    'strat.chart.title': '总利息对比',
    'strat.chart.current': '当前',
    'strat.chart.option_a': '方案A (缩短)',
    'strat.chart.option_b': '方案B (减供)',
    'strat.opt_a.title': '方案A：缩短年限',
    'strat.opt_a.tag': '财富最大化',
    'strat.opt_a.saved': '节省总利息',
    'strat.opt_a.new_monthly': '新月供',
    'strat.opt_a.term_reduced': '年限缩短',
    'strat.opt_a.significantly': '大幅缩短',
    'strat.opt_b.title': '方案B：减少月供',
    'strat.opt_b.tag': '现金流为王',
    'strat.opt_b.reduction': '月供减少',
    'strat.sim_loan.add_btn': '添加模拟贷款',
    'strat.sim_loan.title': '额外模拟贷款 (仅本次)',
    'strat.sim_loan.add_title': '添加贷款到模拟',
    'strat.sim_loan.cancel': '取消',
    'strat.sim_loan.add': '添加',

    'opp.title': '机会成本分析器',
    'opp.cost_debt': '债务成本 (加权)',
    'opp.invest_return': '您的投资回报率 (%)',
    'opp.invest_desc': "例如：余额宝、银行理财",
    'opp.repay.title': '建议还款',
    'opp.repay.desc': '您的债务成本超过了投资回报。持有现金正在亏钱。',
    'opp.repay.loss': '预计10年亏损 (基于50万本金):',
    'opp.hold.title': '建议持有',
    'opp.hold.desc': '您的投资跑赢了贷款利息。保持流动性。',
    'opp.hold.gain': '套利收益:',
    'opp.why.title': '为什么机会成本很重要',
    'opp.why.desc': "在当前的中国经济环境下，贷款利率（债务成本）与安全投资收益率（现金回报）之间的差额决定了您的最佳行动。如果您的房贷利率（例如3.85%）高于您从银行存款或债券基金中获得的收益（例如2.5%），那么您不还款的每一天实际上都在亏钱。",

    'policy.title': '政策与资格解读',
    'policy.city.label': '选择城市',
    'policy.prop.label': '您的家庭目前在{city}拥有几套住宅？',
    'policy.hist.title': '贷款记录',
    'policy.hist.desc': '您在中国任何地方是否有过住房贷款记录（已结清或正在还款）？',
    'policy.hist.yes': '是，有记录',
    'policy.hist.no': '否，从未',
    'policy.back': '返回',
    'policy.status.first': '首套房资格',
    'policy.status.second': '二套房资格',
    'policy.result.desc': '基于{city}“认房不认贷”政策。',
    'policy.down_payment': '首付比例',
    'policy.rate_floor': '利率下限',
    'policy.analysis': '分析：',
    'policy.analysis.text': '因为您在{city}拥有{count}套房产，您的过往贷款记录被{historyStatus}。',
    'policy.analysis.ignored': '忽略',
    'policy.analysis.secondary': '视为次要因素',
    'policy.analysis.bonus': '即使您之前有贷款记录，现在仍被视为首套房买家！',
    'policy.check_another': '查看其他情况',

    'lpr.title': '历史LPR走势',
    'lpr.subtitle': '5年期（房贷）vs 1年期利率历史',
    'lpr.legend.5y': '5年期 LPR',
    'lpr.legend.1y': '1年期 LPR',
    'lpr.source': '数据来源：中国人民银行 / 全国银行间同业拆借中心',
    'lpr.updated': '最后更新：2025年1月',
    'lpr.loading': '正在加载市场数据...',
    'lpr.error': '无法获取最新LPR利率。',
    'lpr.retry': '重试',

    'ai.title': 'AI 财务顾问',
    'ai.desc': '不确定该怎么做？让 Gemini AI 分析您的具体债务结构、机会成本和还款方案，提供个性化建议。',
    'ai.btn.generate': '生成分析报告',
    'ai.loading': '正在咨询财务模型...',
    'ai.clear': '清除分析'
  },
  'zh-TW': {
    'app.title': '智策房貸 CN',
    'app.subtitle': '中國業主的戰略決策支持系統。應對LPR調整、提前還款和政策資格認定。',
    'nav.dashboard': '策略儀表盤',
    'nav.loans': '貸款管理',
    'nav.policy': '政策解讀',
    'nav.opportunity': '機會成本',
    'ticker.update': '更新：5年期LPR現為 3.60% • 公積金 2.85%',
    'ticker.live': '實時',

    'loan.manager.title': '貸款組合管理器',
    'loan.manager.subtitle': '管理您現有的債務結構',
    'loan.total_outstanding': '剩餘貸款總額',
    'loan.weighted_rate': '加權利率',
    'loan.filter.label': '按類型篩選',
    'loan.tab.combined': '綜合',
    'loan.tab.commercial': '商業貸款',
    'loan.tab.provident': '公積金',
    'loan.type.commercial': '商業貸款',
    'loan.type.provident': '公積金',
    'loan.label.balance': '餘額 (元)',
    'loan.label.rate': '利率 (%)',
    'loan.label.months': '剩餘月數',
    'loan.label.method': '還款方式',
    'loan.method.equal_payment': '等額本息',
    'loan.method.equal_principal': '等額本金',
    'loan.add.commercial': '添加商貸',
    'loan.add.provident': '添加公積金',
    'loan.empty': '該類別下沒有貸款。',
    'loan.history.title': '基準利率走勢',
    'loan.history.subtitle': '近幾年5年以上貸款基準利率變化',
    'loan.schedule.view': '查看還款計劃',
    'loan.schedule.hide': '收起還款計劃',
    'loan.schedule.title': '還款計劃表（未來5年）',
    'loan.schedule.desc': '綠色代表本金（減少債務），紅色代表利息（銀行收益）。通常還款初期利息佔比較大。',
    'loan.schedule.principal': '本金',
    'loan.schedule.interest': '利息',
    'loan.schedule.balance': '剩餘本金',
    'loan.schedule.month': '期數',
    'loan.clear.button': '清空全部',
    'loan.clear.confirm': '確定要刪除所有貸款嗎？此操作無法撤銷。',
    'loan.error.balance': '貸款餘額必須大於0',
    'loan.error.rate': '利率不能為負數',
    'loan.error.months': '剩餘月數必須為正整數',
    'loan.error.required': '必填項',
    'loan.recurring.title': '週期性還款設置',
    'loan.recurring.btn': '週期還款',
    'loan.recurring.enable': '開啟週期性還款',
    'loan.recurring.amount': '還款金額',
    'loan.recurring.frequency': '頻率',
    'loan.freq.weekly': '每週',
    'loan.freq.bi_weekly': '每兩週',
    'loan.freq.monthly': '每月',

    'strat.title': '還款策略引擎',
    'strat.cash_on_hand': '手頭現金 (元)',
    'strat.safety_buffer': '安全緩衝資金',
    'strat.safety_desc': '保留此金額用於應急。實際還款金額：',
    'strat.chart.title': '總利息對比',
    'strat.chart.current': '當前',
    'strat.chart.option_a': '方案A (縮短)',
    'strat.chart.option_b': '方案B (減供)',
    'strat.opt_a.title': '方案A：縮短年限',
    'strat.opt_a.tag': '財富最大化',
    'strat.opt_a.saved': '節省總利息',
    'strat.opt_a.new_monthly': '新月供',
    'strat.opt_a.term_reduced': '年限縮短',
    'strat.opt_a.significantly': '大幅縮短',
    'strat.opt_b.title': '方案B：減少月供',
    'strat.opt_b.tag': '現金流為王',
    'strat.opt_b.reduction': '月供減少',
    'strat.sim_loan.add_btn': '添加模擬貸款',
    'strat.sim_loan.title': '額外模擬貸款 (僅本次)',
    'strat.sim_loan.add_title': '添加貸款到模擬',
    'strat.sim_loan.cancel': '取消',
    'strat.sim_loan.add': '添加',

    'opp.title': '機會成本分析器',
    'opp.cost_debt': '債務成本 (加權)',
    'opp.invest_return': '您的投資回報率 (%)',
    'opp.invest_desc': "例如：餘額寶、銀行理財",
    'opp.repay.title': '建議還款',
    'opp.repay.desc': '您的債務成本超過了投資回報。持有現金正在虧錢。',
    'opp.repay.loss': '預計10年虧損 (基於50萬本金):',
    'opp.hold.title': '建議持有',
    'opp.hold.desc': '您的投資跑赢了貸款利息。保持流動性。',
    'opp.hold.gain': '套利收益:',
    'opp.why.title': '為什麼機會成本很重要',
    'opp.why.desc': "在當前的中國經濟環境下，貸款利率（債務成本）與安全投資收益率（現金回報）之間的差額決定了您的最佳行動。如果您的房貸利率（例如3.85%）高於您從銀行存款或債券基金中獲得的收益（例如2.5%），那麼您不還款的每一天實際上都在虧錢。",

    'policy.title': '政策與資格解讀',
    'policy.city.label': '選擇城市',
    'policy.prop.label': '您的家庭目前在{city}擁有幾套住宅？',
    'policy.hist.title': '貸款記錄',
    'policy.hist.desc': '您在中國任何地方是否有過住房貸款記錄（已結清或正在還款）？',
    'policy.hist.yes': '是，有記錄',
    'policy.hist.no': '否，從未',
    'policy.back': '返回',
    'policy.status.first': '首套房資格',
    'policy.status.second': '二套房資格',
    'policy.result.desc': '基於{city}“認房不認貸”政策。',
    'policy.down_payment': '首付比例',
    'policy.rate_floor': '利率下限',
    'policy.analysis': '分析：',
    'policy.analysis.text': '因為您在{city}擁有{count}套房產，您的過往貸款記錄被{historyStatus}。',
    'policy.analysis.ignored': '忽略',
    'policy.analysis.secondary': '視為次要因素',
    'policy.analysis.bonus': '即使您之前有貸款記錄，現在仍被視為首套房買家！',
    'policy.check_another': '查看其他情況',

    'lpr.title': '歷史LPR走勢',
    'lpr.subtitle': '5年期（房贷）vs 1年期利率歷史',
    'lpr.legend.5y': '5年期 LPR',
    'lpr.legend.1y': '1年期 LPR',
    'lpr.source': '數據來源：中國人民銀行 / 全國銀行間同業拆借中心',
    'lpr.updated': '最後更新：2025年1月',
    'lpr.loading': '正在加載市場數據...',
    'lpr.error': '無法獲取最新LPR利率。',
    'lpr.retry': '重試',

    'ai.title': 'AI 財務顧問',
    'ai.desc': '不確定該怎麼做？讓 Gemini AI 分析您的具體債務結構、機會成本和還款方案，提供個性化建議。',
    'ai.btn.generate': '生成分析報告',
    'ai.loading': '正在諮詢財務模型...',
    'ai.clear': '清除分析'
  }
};

interface I18nContextProps {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string, params?: Record<string, any>) => string;
}

const I18nContext = createContext<I18nContextProps | undefined>(undefined);

export const I18nProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>('en');

  const t = (key: string, params?: Record<string, any>) => {
    let text = translations[language][key as keyof typeof translations['en']] || key;
    
    if (params) {
      Object.entries(params).forEach(([paramKey, paramValue]) => {
        text = text.replace(`{${paramKey}}`, String(paramValue));
      });
    }
    
    return text;
  };

  return (
    <I18nContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </I18nContext.Provider>
  );
};

export const useTranslation = () => {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useTranslation must be used within an I18nProvider');
  }
  return context;
};
